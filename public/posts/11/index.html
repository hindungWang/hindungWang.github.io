<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="经常会使用到队列以及优先队列等数据结构，分别使用多种方法实现go的queue和priority_queue。"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Golang实现优先队列"><meta property="og:description" content="经常会使用到队列以及优先队列等数据结构，分别使用多种方法实现go的queue和priority_queue。"><meta property="og:type" content="article"><meta property="og:url" content="http://hindung.cn/posts/11/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-23T00:00:00+00:00"><meta property="article:modified_time" content="2020-09-23T00:00:00+00:00"><title>Golang实现优先队列 | Hindung Blogs</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=stylesheet href=/book.scss integrity crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.babd2f636c40f8c2a90eb07eec05db5d5b170c6461306029c9a468cc2daf879d.js integrity="sha256-ur0vY2xA+MKpDrB+7AXbXVsXDGRhMGApyaRozC2vh50=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Hindung Blogs</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Golang实现优先队列</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#heap原理>heap原理</a></li><li><a href=#containerheap源码>container/heap源码</a><ul><li><a href=#简单使用>简单使用</a></li></ul></li><li><a href=#其他方法实现heap>其他方法实现heap</a></li></ul></nav></aside></header><article class=markdown><h1><a href=/posts/11/>Golang实现优先队列</a></h1><h5>September 23, 2020</h5><div><a href=/tags/queue/>queue</a>,
<a href=/tags/heap/>heap</a>,
<a href=/tags/go/>Go</a>,
<a href=/tags/algorithm/>Algorithm</a></div><h2 id=前言>前言
<a class=anchor href=#%e5%89%8d%e8%a8%80>#</a></h2><p>由于刷题时偶尔会用到队列以及优先队列等数据结构，其他语言都有现成的实现，如C++的priority_queue等，使用非常方便，但是由于个人比较喜欢使用golang语言进行答题，但是go对队列以及优先队列的实现只提供了一个接口，即container/heap包中的heap数据结构，故实现还是要自己去码，这里做一个笔记。实现了heap接口来实现priority_queue，并且提供了其他方法的实现。</p><h2 id=heap原理>heap原理
<a class=anchor href=#heap%e5%8e%9f%e7%90%86>#</a></h2><p>go的container/heap包实现的是数据结构是数组构成的二叉树（完全二叉树），如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 树中某个节点的值总是不大于或不小于其孩子节点的值；
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 树中每个节点的子树都是堆树
</span></span></span><span style=display:flex><span><span style=color:#75715e>// index  0  1  2  3  4   5  6   7   8  9
</span></span></span><span style=display:flex><span><span style=color:#75715e>// index  1  2  3  4   5  6   7   8  9  10
</span></span></span><span style=display:flex><span><span style=color:#75715e>// a[] = {4, 1, 3, 2, 16, 9, 10, 14, 8, 7}
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                  4
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                /  \
</span></span></span><span style=display:flex><span><span style=color:#75715e>//               1    3
</span></span></span><span style=display:flex><span><span style=color:#75715e>//              / \  / \
</span></span></span><span style=display:flex><span><span style=color:#75715e>//             2  16 9  10
</span></span></span><span style=display:flex><span><span style=color:#75715e>//            /\  /
</span></span></span><span style=display:flex><span><span style=color:#75715e>//           14 8 7
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 若取a[1]为堆顶最大或最小，a[i]的左子节点为a[2i],右子节点为a[2i+1],父节点为a[i/2]:
</span></span></span><span style=display:flex><span><span style=color:#75715e>//          a[i]
</span></span></span><span style=display:flex><span><span style=color:#75715e>//          /  \
</span></span></span><span style=display:flex><span><span style=color:#75715e>//      a[2i]  a[2i+1]
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 若取a[0]为堆顶最大或最小，a[i]的左子节点为a[2i+1],右子节点为a[2i+2],父节点为a[(i-1)/2]
</span></span></span><span style=display:flex><span><span style=color:#75715e>//          a[i]
</span></span></span><span style=display:flex><span><span style=color:#75715e>//          /  \
</span></span></span><span style=display:flex><span><span style=color:#75715e>//    a[2i+1]  a[2i+2]
</span></span></span></code></pre></div><p>而container/heap包采用的是a[0]作为对顶，故左子、右子节点以及父节点表示为a[2i+1]、a[2i+2]、a[(i-1)/2]。</p><h2 id=containerheap源码>container/heap源码
<a class=anchor href=#containerheap%e6%ba%90%e7%a0%81>#</a></h2><p>container/heap包是Go内置的接口，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// The Interface type describes the requirements
</span></span></span><span style=display:flex><span><span style=color:#75715e>// for a type using the routines in this package.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Any type that implements it may be used as a
</span></span></span><span style=display:flex><span><span style=color:#75715e>// min-heap with the following invariants (established after
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Init has been called or if the data is empty or sorted):
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>//	!h.Less(j, i) for 0 &lt;= i &lt; h.Len() and 2*i+1 &lt;= j &lt;= 2*i+2 and j &lt; h.Len()
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Note that Push and Pop in this interface are for package heap&#39;s
</span></span></span><span style=display:flex><span><span style=color:#75715e>// implementation to call. To add and remove things from the heap,
</span></span></span><span style=display:flex><span><span style=color:#75715e>// use heap.Push and heap.Pop.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Interface</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>sort</span>.<span style=color:#a6e22e>Interface</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Push</span>(<span style=color:#a6e22e>x</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#75715e>// add x as element Len()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Pop</span>() <span style=color:#66d9ef>interface</span>{}   <span style=color:#75715e>// remove and return element Len() - 1.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Init establishes the heap invariants required by the other routines in this package.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Init is idempotent with respect to the heap invariants
</span></span></span><span style=display:flex><span><span style=color:#75715e>// and may be called whenever the heap invariants may have been invalidated.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// The complexity is O(n) where n = h.Len().
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Init</span>(<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>Interface</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// heapify
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>n</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Len</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>n</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>--</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>down</span>(<span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>n</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Push pushes the element x onto the heap.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// The complexity is O(log n) where n = h.Len().
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Push</span>(<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>Interface</span>, <span style=color:#a6e22e>x</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Push</span>(<span style=color:#a6e22e>x</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>up</span>(<span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Len</span>()<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Pop removes and returns the minimum element (according to Less) from the heap.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// The complexity is O(log n) where n = h.Len().
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Pop is equivalent to Remove(h, 0).
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Pop</span>(<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>Interface</span>) <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>n</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Len</span>() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Swap</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>n</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>down</span>(<span style=color:#a6e22e>h</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>n</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Pop</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Remove removes and returns the element at index i from the heap.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// The complexity is O(log n) where n = h.Len().
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Remove</span>(<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>Interface</span>, <span style=color:#a6e22e>i</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>n</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Len</span>() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>n</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>i</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Swap</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>n</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>down</span>(<span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>n</span>) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>up</span>(<span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Pop</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Fix re-establishes the heap ordering after the element at index i has changed its value.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Changing the value of the element at index i and then calling Fix is equivalent to,
</span></span></span><span style=display:flex><span><span style=color:#75715e>// but less expensive than, calling Remove(h, i) followed by a Push of the new value.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// The complexity is O(log n) where n = h.Len().
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Fix</span>(<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>Interface</span>, <span style=color:#a6e22e>i</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>down</span>(<span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Len</span>()) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>up</span>(<span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>up</span>(<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>Interface</span>, <span style=color:#a6e22e>j</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> (<span style=color:#a6e22e>j</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#75715e>// parent
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>||</span> !<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Less</span>(<span style=color:#a6e22e>j</span>, <span style=color:#a6e22e>i</span>) {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Swap</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>j</span> = <span style=color:#a6e22e>i</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>down</span>(<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>Interface</span>, <span style=color:#a6e22e>i0</span>, <span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>i0</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>j1</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>*</span><span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>j1</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>n</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>j1</span> &lt; <span style=color:#ae81ff>0</span> { <span style=color:#75715e>// j1 &lt; 0 after int overflow
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>j</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>j1</span> <span style=color:#75715e>// left child
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>j2</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>j1</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>j2</span> &lt; <span style=color:#a6e22e>n</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Less</span>(<span style=color:#a6e22e>j2</span>, <span style=color:#a6e22e>j1</span>) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>j</span> = <span style=color:#a6e22e>j2</span> <span style=color:#75715e>// = 2*i + 2  // right child
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Less</span>(<span style=color:#a6e22e>j</span>, <span style=color:#a6e22e>i</span>) {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Swap</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>i</span> = <span style=color:#a6e22e>j</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>i</span> &gt; <span style=color:#a6e22e>i0</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=简单使用>简单使用
<a class=anchor href=#%e7%ae%80%e5%8d%95%e4%bd%bf%e7%94%a8>#</a></h3><p>由以上源码可知，要实现一个heap数据结构，需要实现Len()、Less()（根据这里控制大顶堆还是小顶堆）、Swap()、Push()、Pop()、Fix()(或Update())方法，其中Fix方法是可选的。Fix方法主要是传入元素和元素所在数组的index，并且下沉该元素。</p><p>下面实现一个简单的[]int数组构成的heap。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>heap</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>IntHeap</span> []<span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>IntHeap</span>) <span style=color:#a6e22e>Len</span>() <span style=color:#66d9ef>int</span>           { <span style=color:#66d9ef>return</span> len(<span style=color:#a6e22e>h</span>) }
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>IntHeap</span>) <span style=color:#a6e22e>Less</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>bool</span> { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>i</span>] &lt; <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>j</span>] }
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>IntHeap</span>) <span style=color:#a6e22e>Swap</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span> <span style=color:#66d9ef>int</span>)      { <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>i</span>], <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>j</span>] = <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>j</span>], <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>i</span>] }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>IntHeap</span>) <span style=color:#a6e22e>Push</span>(<span style=color:#a6e22e>x</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span><span style=color:#a6e22e>h</span> = append(<span style=color:#f92672>*</span><span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>x</span>.(<span style=color:#66d9ef>int</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>IntHeap</span>) <span style=color:#a6e22e>Pop</span>() <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>old</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>h</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>old</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>x</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>old</span>[<span style=color:#a6e22e>n</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span><span style=color:#a6e22e>h</span> = <span style=color:#a6e22e>old</span>[<span style=color:#ae81ff>0</span> : <span style=color:#a6e22e>n</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>*  test file
</span></span></span><span style=display:flex><span><span style=color:#75715e>**/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>heap</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;container/heap&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestHeap</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>h</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>IntHeap</span>{<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>5</span>,<span style=color:#ae81ff>6</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>heap</span>.<span style=color:#a6e22e>Init</span>(<span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>heap</span>.<span style=color:#a6e22e>Push</span>(<span style=color:#a6e22e>h</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Len</span>() &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>heap</span>.<span style=color:#a6e22e>Pop</span>(<span style=color:#a6e22e>h</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>*  output
</span></span></span><span style=display:flex><span><span style=color:#75715e>**/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>= <span style=color:#a6e22e>RUN</span>   <span style=color:#a6e22e>TestHeap</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> <span style=color:#ae81ff>6</span>
</span></span></code></pre></div><p>这样就可以实现int数组的小顶堆，如果需要实现更加复杂的数据结构的heap，可以参考[]int的方法来实现，如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>heap</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Data</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>key</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>value</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>wight</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DataHeap</span> []<span style=color:#a6e22e>Data</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>DataHeap</span>) <span style=color:#a6e22e>Len</span>() <span style=color:#66d9ef>int</span>           { <span style=color:#66d9ef>return</span> len(<span style=color:#a6e22e>h</span>) }
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>DataHeap</span>) <span style=color:#a6e22e>Less</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>bool</span> { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>wight</span> &lt; <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>j</span>].<span style=color:#a6e22e>wight</span> }
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#a6e22e>DataHeap</span>) <span style=color:#a6e22e>Swap</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span> <span style=color:#66d9ef>int</span>)      { <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>i</span>], <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>j</span>] = <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>j</span>], <span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>i</span>] }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DataHeap</span>) <span style=color:#a6e22e>Push</span>(<span style=color:#a6e22e>x</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span><span style=color:#a6e22e>h</span> = append(<span style=color:#f92672>*</span><span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>x</span>.(<span style=color:#a6e22e>Data</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>DataHeap</span>) <span style=color:#a6e22e>Pop</span>() <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>old</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>h</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>old</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>x</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>old</span>[<span style=color:#a6e22e>n</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span><span style=color:#a6e22e>h</span> = <span style=color:#a6e22e>old</span>[<span style=color:#ae81ff>0</span> : <span style=color:#a6e22e>n</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>*  test file
</span></span></span><span style=display:flex><span><span style=color:#75715e>**/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>heap</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;container/heap&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestDataHeap</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>h</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>DataHeap</span>{<span style=color:#a6e22e>Data</span>{<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>3</span>},<span style=color:#a6e22e>Data</span>{<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>5</span>},
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Data</span>{<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>0</span>},<span style=color:#a6e22e>Data</span>{<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>2</span>}}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>heap</span>.<span style=color:#a6e22e>Init</span>(<span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>heap</span>.<span style=color:#a6e22e>Push</span>(<span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>Data</span>{<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>4</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>340</span>})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>Len</span>() &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>heap</span>.<span style=color:#a6e22e>Pop</span>(<span style=color:#a6e22e>h</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>*  output
</span></span></span><span style=display:flex><span><span style=color:#75715e>**/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>= <span style=color:#a6e22e>RUN</span>   <span style=color:#a6e22e>TestDataHeap</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> {<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>340</span>}
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> {<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> {<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>2</span>}
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> {<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>}
</span></span><span style=display:flex><span><span style=color:#ae81ff>2020</span><span style=color:#f92672>/</span><span style=color:#ae81ff>09</span><span style=color:#f92672>/</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>59</span>:<span style=color:#ae81ff>59</span> {<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span>}
</span></span></code></pre></div><h2 id=其他方法实现heap>其他方法实现heap
<a class=anchor href=#%e5%85%b6%e4%bb%96%e6%96%b9%e6%b3%95%e5%ae%9e%e7%8e%b0heap>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;math/rand&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 堆实现最小优先队列，即最小堆
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 数据结构是数组构成的二叉树（完全二叉树）
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 树中某个节点的值总是不大于或不小于其孩子节点的值；
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 树中每个节点的子树都是堆树
</span></span></span><span style=display:flex><span><span style=color:#75715e>//        1  2  3  4   5  6   7   8  9  10
</span></span></span><span style=display:flex><span><span style=color:#75715e>// a[] = {4, 1, 3, 2, 16, 9, 10, 14, 8, 7}
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                  4
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                /  \
</span></span></span><span style=display:flex><span><span style=color:#75715e>//               1    3
</span></span></span><span style=display:flex><span><span style=color:#75715e>//              / \  / \
</span></span></span><span style=display:flex><span><span style=color:#75715e>//             2  16 9  10
</span></span></span><span style=display:flex><span><span style=color:#75715e>//            /\  /
</span></span></span><span style=display:flex><span><span style=color:#75715e>//           14 8 7
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 若取a[1]为堆顶最大或最小，a[i]的左子节点为a[2i],右子节点为a[2i+1],父节点为a[i/2]
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 若取a[0]为堆顶最大或最小，a[i]的左子节点为a[2i+1],右子节点为a[2i+2],父节点为a[(i-1)/2]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>PriorityHeap</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>arr</span> []<span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PriorityHeap</span>) <span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>pri</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span> = append(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>, <span style=color:#a6e22e>pri</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>/*if len(p.arr) == 0 {
</span></span></span><span style=display:flex><span><span style=color:#75715e>		return
</span></span></span><span style=display:flex><span><span style=color:#75715e>	}*/</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// fixup 比父节点小的就上浮
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>end</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>father</span> <span style=color:#f92672>:=</span> (<span style=color:#a6e22e>end</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> ) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>father</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>father</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>end</span>] {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>father</span>], <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>end</span>] = <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>end</span>], <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>father</span>]
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>end</span> = <span style=color:#a6e22e>father</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>father</span> = (<span style=color:#a6e22e>end</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> ) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PriorityHeap</span>) <span style=color:#a6e22e>pop</span>() <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>length</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>length</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>res</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>length</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span> = []<span style=color:#66d9ef>int</span>{}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>res</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#ae81ff>0</span>] = <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>length</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span> = <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[:<span style=color:#a6e22e>length</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>length</span> = len(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// fix down 比左、右节点小的越小越往哪边下沉
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>farther</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>min</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>farther</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>min</span> &lt; <span style=color:#a6e22e>length</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>min</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span> &lt; <span style=color:#a6e22e>length</span> { <span style=color:#75715e>// 右节点存在？
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>min</span>] &gt; <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>min</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] { <span style=color:#75715e>// 左节点比右节点大？
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>				<span style=color:#a6e22e>min</span><span style=color:#f92672>++</span> <span style=color:#75715e>// 那就用右节点，否则往左子节点下沉
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>farther</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>min</span>] {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>farther</span>], <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>min</span>] = <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>min</span>], <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>arr</span>[<span style=color:#a6e22e>farther</span>]
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>farther</span> = <span style=color:#a6e22e>min</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>min</span> = <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>farther</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>res</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>initHeap</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>PriorityHeap</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>PriorityHeap</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>arr</span>: []<span style=color:#66d9ef>int</span>{},
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>p</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>initHeap</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Seed</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Unix</span>())
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>:=</span><span style=color:#ae81ff>0</span>;<span style=color:#a6e22e>i</span>&lt;<span style=color:#ae81ff>10</span>;<span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Int</span>() <span style=color:#f92672>%</span> <span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>:=</span><span style=color:#ae81ff>0</span>;<span style=color:#a6e22e>i</span>&lt;<span style=color:#ae81ff>10</span>;<span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>pop</span>(), <span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>pop</span>())
</span></span><span style=display:flex><span><span style=color:#75715e>/*  output:
</span></span></span><span style=display:flex><span><span style=color:#75715e>    17 0
</span></span></span><span style=display:flex><span><span style=color:#75715e>	47 1
</span></span></span><span style=display:flex><span><span style=color:#75715e>	49 2
</span></span></span><span style=display:flex><span><span style=color:#75715e>	52 3
</span></span></span><span style=display:flex><span><span style=color:#75715e>	55 4
</span></span></span><span style=display:flex><span><span style=color:#75715e>	55 5
</span></span></span><span style=display:flex><span><span style=color:#75715e>	71 6
</span></span></span><span style=display:flex><span><span style=color:#75715e>	74 7
</span></span></span><span style=display:flex><span><span style=color:#75715e>	93 8
</span></span></span><span style=display:flex><span><span style=color:#75715e>	98 9
</span></span></span><span style=display:flex><span><span style=color:#75715e>	-1*/</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#heap原理>heap原理</a></li><li><a href=#containerheap源码>container/heap源码</a><ul><li><a href=#简单使用>简单使用</a></li></ul></li><li><a href=#其他方法实现heap>其他方法实现heap</a></li></ul></nav></div></aside></main></body></html>