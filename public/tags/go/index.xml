<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Go on Hindung's Blog</title><link>https://hindung.cn/tags/go/</link><description>Recent content in Go on Hindung's Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 19 Jul 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://hindung.cn/tags/go/index.xml" rel="self" type="application/rss+xml"/><item><title>K8s client-goåˆå§‹åŒ–çš„å‡ ç§æ–¹æ³•</title><link>https://hindung.cn/posts/k8s-client/</link><pubDate>Tue, 19 Jul 2022 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/k8s-client/</guid><description>ç®€ä»‹ client-goæ˜¯k8sçš„ä¸€ä¸ªåŸºç¡€ç»„ä»¶åº“ï¼Œæ˜¯ç”¨äºä¸API-Serveräº¤äº’çš„httpå®¢æˆ·ç«¯ã€‚K8sä¸­å¤§éƒ¨åˆ†ç»„ä»¶éƒ½ä½¿ç”¨äº†è¿™ä¸ªåº“å®ç°ä¸API-Serverçš„é€šä¿¡åŠŸèƒ½ã€‚é™¤äº†èƒ½å¤Ÿå¯¹èµ„æºå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥ï¼Œè¿˜å¯Watchä¸€ä¸ªå¯¹è±¡ã€å‡çº§æˆwebsocketé“¾æ¥ç­‰ç­‰åŠŸèƒ½ã€‚
client-goæ”¯æŒå››ç§å®¢æˆ·ç«¯ï¼šRESTClientã€ClientSetã€DynamicClientã€DiscoveryClientã€‚è¿™å‡ ä¸ªclientå¯ä»¥ç›¸äº’è½¬æ¢ã€‚
RESTClient RESTClientæ˜¯æœ€åŸºç¡€çš„å®¢æˆ·ç«¯ï¼Œç›¸å½“äºæœ€åº•å±‚çš„åŸºç¡€ç»“æ„ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡RESTClientæä¾›çš„RESTfulæ–¹æ³•å¦‚Get()ã€Put()ã€Post()ã€Delete()è¿›è¡Œäº¤äº’ã€‚
ä¸€èˆ¬è€Œè¨€ï¼Œä¸ºäº†æ›´ä¸ºä¼˜é›…çš„å¤„ç†ï¼Œéœ€è¦è¿›ä¸€æ­¥å°è£…ï¼Œé€šè¿‡Clientsetå°è£…RESTClientï¼Œç„¶åå†å¯¹å¤–æä¾›æ¥å£å’ŒæœåŠ¡ã€‚
å¯ä»¥é€šè¿‡ClientSetå®¢æˆ·ç«¯è·å¾—ï¼š
client := cli.CoreV1().RESTClient().(*rest.RESTClient) ClientSet Clientsetæ˜¯è°ƒç”¨Kubernetesèµ„æºå¯¹è±¡æœ€å¸¸ç”¨çš„clientï¼Œå¯ä»¥æ“ä½œæ‰€æœ‰çš„èµ„æºå¯¹è±¡ï¼ŒåŒ…å«RESTClientã€‚éœ€è¦åˆ¶å®šGroupã€Versionï¼Œç„¶åæ ¹æ®Resourceè·å–ã€‚
clientset,err := kubernetes.NewForConfig(config) sa, err := clientset.CoreV1().ServiceAccounts(&amp;#34;kube-system&amp;#34;).Get(&amp;#34;kube-shell-admin&amp;#34;, metav1.GetOptions{}) DynamicClient Dynamic clientæ˜¯ä¸€ç§åŠ¨æ€çš„clientï¼Œå®ƒèƒ½å¤„ç†kubernetesæ‰€æœ‰çš„èµ„æºã€‚ä¸åŒäºclientsetï¼Œdynamic clientè¿”å›çš„å¯¹è±¡æ˜¯ä¸€ä¸ªmap[string]interface{}ã€‚
dynamicClient,err := dynamic.NewForConfig(config) gvr := schema.GroupVersionResource{Version: &amp;#34;v1&amp;#34;,Resource: &amp;#34;pods&amp;#34;} unstructObjList,err := dynamicClient.Resource(gvr).Namespace(&amp;#34;dev&amp;#34;).List(context.TODO(),metav1.ListOptions{Limit: 100}) DiscoveryClient DiscoveryClientæ˜¯å‘ç°å®¢æˆ·ç«¯ï¼Œä¸»è¦ç”¨äºå‘ç°kubernetes API Serveræ‰€æ”¯æŒçš„èµ„æºç»„ã€èµ„æºç‰ˆæœ¬ã€èµ„æºä¿¡æ¯ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å°†è¿™äº›ä¿¡æ¯å­˜å‚¨åˆ°æœ¬åœ°ï¼Œç”¨æˆ·æœ¬åœ°ç¼“å­˜ï¼Œä»¥å‡è½»å¯¹Kubernetes API Serverè®¿é—®çš„å‹åŠ›ã€‚ kubectlçš„api-versionså’Œapi-resourceså‘½ä»¤è¾“å‡ºä¹Ÿæ˜¯é€šè¿‡DisconversyClientå®ç°çš„ã€‚
discoveryClient,err := discovery.NewDiscoveryClientForConfig(config) APIGroup,APIResourceListSlice,err := discoveryClient.ServerGroupsAndResources() è¿™å‡ ç§å®¢æˆ·ç«¯çš„åˆå§‹åŒ–éƒ½æ¶‰åŠåˆ°äº†å…¥å‚configï¼Œå³*rest.Configï¼Œè¿™ä¸ªæ˜¯ç”¨äºåˆå§‹åŒ–å®¢æˆ·ç«¯çš„æ‰€æœ‰é…ç½®ä¿¡æ¯ã€‚
rest.Configåˆå§‹åŒ– åˆ›å»ºclientå‰ï¼Œéœ€è¦å…ˆä»åˆå§‹åŒ–*rest.Configï¼Œè¿™ä¸ª*rest.Configå¯ä»¥ä»é›†ç¾¤å¤–çš„kubeconfigæ–‡ä»¶æˆ–è€…é›†ç¾¤å†…éƒ¨çš„ tokenFile å’Œ CAFileåˆå§‹åŒ–ï¼ˆé€šè¿‡ServiceAcountè‡ªåŠ¨æŒ‚è½½ï¼‰ã€‚æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š
é›†ç¾¤å¤–é€šè¿‡kubeconfigåˆå§‹åŒ– BuildConfigFromFlagsæ–¹æ³•ä»ç»™å®šçš„urlæˆ–è€…kubeconfigæ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„å»åˆå§‹åŒ–configï¼Œå¦‚æœä¸æˆåŠŸåˆ™ä¼šä½¿ç”¨é›†ç¾¤å†…éƒ¨æ–¹æ³•åˆå§‹åŒ–configï¼Œå¦‚æœä¸æˆåŠŸåˆ™è¿”å›ä¸€ä¸ªé»˜è®¤çš„configã€‚
// &amp;#34;k8s.io/client-go/tools/clientcmd&amp;#34; config, err := clientcmd.BuildConfigFromFlags(&amp;#34;&amp;#34;, *kubeconfig) if err != nil { panic(err.Error()) } å†…å­˜ä¸­é€šè¿‡kubeconfigå­—ç¬¦ä¸²æˆ–è€…byteæ•°ç»„åˆå§‹åŒ– é€šè¿‡è¯»å–kubeconfigæ–‡ä»¶å†…å®¹è¿›è¡Œåˆå§‹åŒ–ä¸€ä¸ªconfigï¼š</description></item><item><title>Goæºç è§£è¯»ä¹‹sync.Cond</title><link>https://hindung.cn/posts/go-sync-cond/</link><pubDate>Sun, 16 May 2021 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/go-sync-cond/</guid><description>å‰è¨€ å‰é¢ğŸ”—è¯´è¿‡ï¼ŒCondå®ç°äº†ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œæ˜¯ç­‰å¾…æˆ–å®£å¸ƒä¸€ä¸ªäº‹ä»¶å‘ç”Ÿçš„goroutinesçš„æ±‡åˆç‚¹ã€‚
å°±æ˜¯è¯´ï¼Œä½¿ç”¨sync.Condå¯ä»¥åšåˆ°å¤šä¸ªåç¨‹ç­‰å¾…æŸä¸ªåç¨‹é€šçŸ¥çš„åœºæ™¯ã€‚
ä½¿ç”¨channelå¯ä»¥å®ç°ä¸€è¯»ä¸€å†™çš„åœºæ™¯ï¼Œè€ŒCondåˆ™å®ç°å¤šè¯»ä¸€å†™çš„åœºæ™¯ã€‚
æºç è§£æ ç®€åŒ–ç‰ˆæ–¹æ³•ç­¾åï¼š
// Condç»“æ„ä½“ type Cond struct {} // NewCond è¿”å›å¸¦Lockerçš„Condï¼Œè¿™ä¸ªLockerå¯ä»¥æ˜¯ // *Mutex æˆ– *RWMutex func NewCond(l Locker) *Cond {} // ç­‰å¾…Lçš„è§£é”å¹¶æŒ‚èµ·goroutine func (c *Cond) Wait() {} // å”¤é†’1ä¸ªå› cé˜»å¡çš„goroutineï¼Œ // å¦‚æœåœ¨Signalä¹‹åæ‰Waitä¼šå¯¼è‡´all goroutines are asleep - deadlock func (c *Cond) Signal() {} // å”¤é†’æ‰€æœ‰å› cé˜»å¡çš„goroutine // å¦‚æœåœ¨Broadcastä¹‹åæ‰Waitä¼šå¯¼è‡´all goroutines are asleep - deadlock func (c *Cond) Broadcast() {} å› æ­¤ï¼Œåœ¨Signalæˆ–è€…Broadcastå‰è¦å…ˆä¿è¯ç›®æ ‡çš„åç¨‹å·²ç»è¿›å…¥äº†WaitçŠ¶æ€ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ­»é”ã€‚å› ä¸ºSignalæˆ–è€…Broadcaståªå”¤é†’å½“å‰æ­£åœ¨è¢«Waité˜»å¡çš„åç¨‹ã€‚
Condçš„å®šä¹‰ï¼š
// Copyright 2011 The Go Authors. All rights reserved. // Use of this source code is governed by a BSD-style // license that can be found in the LICENSE file.</description></item><item><title>Goæºç è§£è¯»ä¹‹syncä¸­çš„åŸºæœ¬ç±»å‹å’Œä½¿ç”¨åœºæ™¯</title><link>https://hindung.cn/posts/go-sync-type/</link><pubDate>Tue, 11 May 2021 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/go-sync-type/</guid><description>Overview åŒ…é“¾æ¥ğŸ”—
syncåŒ…æä¾›åŸºæœ¬çš„åŒæ­¥åŸè¯­ï¼Œä¾‹å¦‚äº’æ–¥é”ã€‚
é™¤äº†Onceå’ŒWaitGroupç±»å‹å¤–ï¼Œå¤§å¤šæ•°éƒ½æ˜¯ä¾›ä½çº§åº“ä¾‹ç¨‹ä½¿ç”¨çš„ã€‚
æ›´é«˜å±‚æ¬¡çš„åŒæ­¥æœ€å¥½é€šè¿‡channelså’Œé€šä¿¡æ¥å®Œæˆã€‚
ä»ä»£ç çœ‹ï¼Œsyncæä¾›äº†å‡ ç§ç±»å‹ï¼š
Condï¼šæ¡ä»¶å˜é‡ Lockerï¼šé”çš„æ¥å£å®šä¹‰ Mapï¼šåç¨‹å¹¶å‘å®‰å…¨çš„Map Mutexï¼šäº’æ–¥é” Onceï¼šå•æ¬¡æ‰§è¡Œ Poolï¼šæ±  RWMutexï¼šè¯»å†™é” WaitGroupï¼šç­‰å¾…ç»„ å‡ ä¸ªç±»å‹åˆ†åˆ«å¯¹åº”ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚
sync.Cond Condå®ç°äº†ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œæ˜¯ç­‰å¾…æˆ–å®£å¸ƒä¸€ä¸ªäº‹ä»¶å‘ç”Ÿçš„goroutinesçš„æ±‡åˆç‚¹ã€‚
é€šä¿—çš„è¯´ï¼Œsync.Condç”¨æ¥åè°ƒé‚£äº›è®¿é—®å…±äº«èµ„æºçš„goroutineï¼Œå½“å…±äº«èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šçŸ¥è¢«é˜»å¡goroutineã€‚
sync.Cond ç»å¸¸ç”¨åœ¨å¤šä¸ª goroutine ç­‰å¾…ä¸€ä¸ª goroutine é€šçŸ¥ï¼ˆäº‹ä»¶å‘ç”Ÿï¼‰çš„åœºæ™¯ã€‚
sync.Map Mapå°±åƒGoä¸­çš„map[interface{}]interface{}ï¼Œä½†å¯¹äºå¤šä¸ªgoroutineçš„å¹¶å‘ä½¿ç”¨æ˜¯å®‰å…¨çš„ï¼Œä¸éœ€è¦é¢å¤–çš„é”æˆ–åè°ƒã€‚
ä½¿ç”¨map + sync.Mutexæˆ–è€…sync.RWMutexçš„æ–¹å¼ä¹Ÿå¯ä»¥å®ç°ä¸sync.Mapç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œsync.Mapå…·æœ‰æ›´é«˜çš„æ€§èƒ½ï¼š
Mapç±»å‹é’ˆå¯¹ä¸¤ç§å¸¸è§ç”¨ä¾‹è¿›è¡Œäº†ä¼˜åŒ–ï¼š
å½“ç»™å®škeyçš„æ¡ç›®ä»…è¢«å†™å…¥ä¸€æ¬¡å´è¢«è¯»å–å¤šæ¬¡æ—¶ï¼Œä¾‹å¦‚åœ¨ä»…å¢é•¿çš„é«˜é€Ÿç¼“å­˜ä¸­ å½“å¤šä¸ªgoroutineè¯»å–ï¼Œå†™å…¥å’Œè¦†ç›–çš„keyéƒ½ä¸ç›¸å…³æ—¶ åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä¸ä¸å•ç‹¬çš„Mutexæˆ–RWMutex + map ç›¸æ¯”ï¼Œä½¿ç”¨Mapå¯ä»¥æ˜¾ç€å‡å°‘é”äº‰ç”¨ã€‚
sync.Mutex Mutexæ˜¯ä¸€ä¸ªç›¸äº’æ’æ–¥çš„é”ã€‚Mutexçš„é›¶å€¼æ˜¯ä¸€ä¸ªè§£é”çš„Mutexã€‚
å½“è°ƒç”¨Lockæ–¹æ³•è¿›è¡ŒåŠ é”æ—¶ï¼Œå¦‚æœé”å·²åœ¨ä½¿ç”¨ä¸­ï¼Œåˆ™goroutineä¼šé˜»å¡ï¼Œç›´åˆ°é”å¯ç”¨ä¸ºæ­¢ã€‚ å½“è°ƒç”¨UnLockæ–¹æ³•è¿›è¡Œè§£é”æ—¶ï¼Œå¦‚æœé”æ²¡æœ‰åœ¨ä½¿ç”¨ï¼Œåˆ™ä¼šå‡ºç°è¿è¡Œæ—¶é”™è¯¯ã€‚
é”å®šçš„äº’æ–¥é”ä¸ç‰¹å®šçš„goroutineæ²¡æœ‰å…³è”ã€‚å…è®¸ä¸€ä¸ªgoroutineé”å®šMutexï¼Œç„¶åå®‰æ’å¦ä¸€ä¸ªgoroutineå¯¹å…¶è¿›è¡Œè§£é”ã€‚
sync.RWMutex RWMutexæ˜¯ä¸€ä¸ªè¯»å†™å™¨ç›¸äº’æ’æ–¥çš„é”ã€‚ è¯¥é”å¯ä»¥ç”±ä»»æ„æ•°é‡çš„è¯»è€…æˆ–å•ä¸€çš„å†™è€…æŒæœ‰ã€‚RWMutexçš„é›¶å€¼æ˜¯ä¸€ä¸ªè§£é”çš„mutexã€‚
è¯»è¯»ä¸äº’æ–¥ï¼Œè¯»å†™äº’æ–¥ï¼Œå†™å†™äº’æ–¥ã€‚
sync.Once Onceçš„Do(f)æ–¹æ³•ä¿è¯åªè¿è¡Œä¸€æ¬¡ï¼Œå³ä½¿få‘ç”Ÿpanicã€‚ è¿™å¸¸ç”¨åœ¨å•ä¾‹æ¨¡å¼ï¼Œé…ç½®æ–‡ä»¶åŠ è½½ï¼Œåˆå§‹åŒ–è¿™äº›åœºæ™¯ä¸‹ã€‚
sync.Pool Poolæ˜¯ä¸€ç»„å¯ä»¥å•ç‹¬ä¿å­˜å’Œæ£€ç´¢çš„ä¸´æ—¶å¯¹è±¡ã€‚ å‚¨å­˜åœ¨æ± å­é‡Œçš„ä»»ä½•å¯¹è±¡éƒ½å¯èƒ½åœ¨ä»»ä½•æ—¶å€™è¢«è‡ªåŠ¨åˆ é™¤ï¼Œè€Œæ— éœ€é€šçŸ¥ã€‚ æ± å¯ä»¥å®‰å…¨åœ°åŒæ—¶è¢«å¤šä¸ªgoroutineä½¿ç”¨ã€‚
Poolçš„ä½œç”¨æ˜¯ç¼“å­˜å·²åˆ†é…ä½†æœªä½¿ç”¨çš„é¡¹ç›®ï¼Œä»¥ä¾¿ä»¥åå†ä½¿ç”¨ï¼Œå‡è½»åƒåœ¾æ”¶é›†å™¨çš„å‹åŠ›ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä½¿å»ºç«‹é«˜æ•ˆã€çº¿ç¨‹å®‰å…¨çš„è‡ªç”±åˆ—è¡¨å˜å¾—å®¹æ˜“ã€‚
æ± çš„ä¸€ä¸ªé€‚å½“çš„ç”¨é€”æ˜¯ç®¡ç†ä¸€ç»„ä¸´æ—¶é¡¹ç›®ï¼Œè¿™äº›ä¸´æ—¶é¡¹ç›®åœ¨åŒ…çš„ç‹¬ç«‹å®¢æˆ·ç«¯ä¹‹é—´é»˜é»˜åœ°å…±äº«ï¼Œå¹¶å¯èƒ½è¢«é‡å¤ä½¿ç”¨ã€‚Poolæä¾›äº†ä¸€ç§åœ¨è®¸å¤šå®¢æˆ·ç«¯ä¹‹é—´åˆ†æ‘Šåˆ†é…å¼€é”€çš„æ–¹æ³•ã€‚
å½“ç„¶ï¼ŒPoolå¹¶ä¸é€‚ç”¨äºä¸€äº›çŸ­å‘½çš„å¯¹è±¡æ± åŒ–ã€‚
ç›¸å½“äºæ‹¿å‡ºæ¥ï¼Œåšæ“ä½œï¼Œå†æ”¾å›å»ï¼Œæ“ä½œè¿‡çš„ä¸œè¥¿æ”¾å›å»çš„æ—¶å€™æ˜¯å•¥æ ·ï¼Œæ‹¿å‡ºæ¥çš„æ—¶å€™å°±æ˜¯å•¥æ ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‹¿å‡ºæ¥ç”¨çš„æ—¶å€™éœ€è¦åˆå§‹åŒ–æ•°æ®æˆ–è€…æ¸…ç©ºã€‚ å¦‚Ginçš„æºç ï¼šhttps://github.com/gin-gonic/gin/blob/v1.7.1/gin.go#L439
// ServeHTTP conforms to the http.Handler interface. func (engine *Engine) ServeHTTP(w http.</description></item><item><title>æ·±æ‹·è´ä¹‹å¾ªç¯å¼•ç”¨</title><link>https://hindung.cn/posts/deep-copy/</link><pubDate>Sat, 08 May 2021 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/deep-copy/</guid><description>é¢˜ç›® å®ç°å¦‚ä¸‹ç»“æ„ä½“çš„æ·±æ‹·è´ã€‚
type Node struct { Data int Fields []*Node } å³æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ä¹Ÿéœ€è¦Copyä¸€ä»½ã€‚
è§£æ è§‚å¯Ÿç»“æ„ä½“ï¼Œç”±äºFieldså­—æ®µé‡Œå­˜æ”¾çš„æ˜¯æŒ‡å‘Nodeç»“æ„ä½“çš„æŒ‡é’ˆåˆ‡ç‰‡ï¼Œæ·±æ‹·è´æ—¶è¦è€ƒè™‘å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå¦‚ï¼š
struct a : data: 1 fields: b, c struct b: data: 2 fields: c struct c: data: 3 fields: a // è¿™é‡Œå¾ªç¯å¼•ç”¨äº†aï¼Œ c-&amp;gt;a-&amp;gt;b, c-&amp;gt;a å¯ä»¥è€ƒè™‘ä½¿ç”¨map[*Node]*Nodeæ¥åˆ¤æ–­æ˜¯å¦æœ‰ç¯çš„æƒ…å†µï¼Œå³ç”¨map[src] = dstæ¥ä¿å­˜æ‹·è´è¿‡çš„èŠ‚ç‚¹ã€‚
ä»£ç  ä»£ç å¦‚ä¸‹ï¼š
package main import ( &amp;#34;go/ast&amp;#34; &amp;#34;go/token&amp;#34; ) type Node struct { Data int Fields []*Node } // deep copy var M map[*Node]*Node func Dup(src *Node) *Node { if src == nil { return nil } node := &amp;amp;Node{ Data: src.</description></item><item><title>Goæºç è§£è¯»ä¹‹sync/atomic</title><link>https://hindung.cn/posts/go-sync-atomic/</link><pubDate>Thu, 29 Apr 2021 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/go-sync-atomic/</guid><description>æ³¨ï¼šgo version 1.16.x
Overview ä»ç½‘ç«™pkg.go.devä¸Šå¯ä»¥çœ‹åˆ°ï¼Œå¯¹åº”çš„è§£é‡Šã€‚
atomicåŒ…æä¾›äº†ç”¨äºå®ç°åŒæ­¥ç®—æ³•çš„ä½çº§åŸå­å†…å­˜åŸè¯­ã€‚
å¯ä»¥åˆ†ä¸ºå‡ ç±»æ“ä½œï¼š
Addæ“ä½œï¼šåŠ å‡æ“ä½œ CASæ“ä½œï¼šå…ˆæ¯”è¾ƒåèµ‹å€¼æ“ä½œ Swapæ“ä½œï¼šèµ‹å€¼æ“ä½œ Loadæ“ä½œï¼šä»æŸä¸ªåœ°å€ä¸­å–å€¼ Storeæ“ä½œï¼šå¾€æŸä¸ªåœ°å€èµ‹å€¼ Valueç±»å‹ï¼šå¯¹ä»»æ„ç±»å‹çš„Load/Storeæ“ä½œå°è£… æ“ä½œåˆ†ç±» Addæ“ä½œ ç”±AddTå‡½æ•°å®ç°çš„åŠ æ³•æ“ä½œåœ¨åŸå­ä¸Šç­‰æ•ˆäºï¼š
*addr += delta \\ åŠ ä¸Šæ­¥é•¿ æ­£è´Ÿæ•°éƒ½å¯ä»¥ return *addr \\ åå›åŠ åçš„ç»“æœ ç›¸å…³çš„æ–¹æ³•æœ‰ï¼š
func AddInt32(addr *int32, delta int32) (new int32) func AddUint32(addr *uint32, delta uint32) (new uint32) func AddInt64(addr *int64, delta int64) (new int64) func AddUint64(addr *uint64, delta uint64) (new uint64) func AddUintptr(addr *uintptr, delta uintptr) (new uintptr) CASæ“ä½œ CASå³CompareAndSwapï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦å°±æ˜¯å…ˆæ¯”è¾ƒä¸€ä¸‹å½“å‰ä¼ å…¥çš„åœ°å€çš„å€¼æ˜¯å¦å’Œ old å€¼ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œå°±èµ‹å€¼æ–°å€¼è¿”å› trueï¼Œå¦‚æœä¸ç›¸ç­‰å°±è¿”å› false.</description></item><item><title>ä½¿ç”¨Goé‡åˆ°çš„å‘</title><link>https://hindung.cn/posts/keng/</link><pubDate>Thu, 01 Apr 2021 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/keng/</guid><description>for range è¯­å¥ä¸­çš„å€¼ä¼ é€’é—®é¢˜ package main import &amp;#34;fmt&amp;#34; var pow = []int{1, 2, 4} func main() { for _, v := range pow { v++ } for _, v := range pow { fmt.Println(v) } } //out put : 1 2 4 åŸå› ï¼šfor rangeåˆ›å»ºäº†æ¯ä¸ªå…ƒç´ çš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›æ¯ä¸ªå…ƒç´ çš„å¼•ç”¨ã€‚
IPv4ä¸IPv6æ ¼å¼é—®é¢˜Â  Goä¸­IPv4çš„é•¿åº¦å’ŒIPv6çš„é•¿åº¦æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯16Byteå­˜å‚¨ï¼Œæ•…ä¸èƒ½ä½¿ç”¨len()å‡½æ•°å»åŒºåˆ«:
conn, err := net.Dial(&amp;#34;udp&amp;#34;, &amp;#34;8.9.10.11:2342&amp;#34;) if err != nil { fmt.Println(&amp;#34;Error&amp;#34;, err) } localaddr := conn.LocalAddr() addr, _ := net.ResolveUDPAddr(&amp;#34;udp&amp;#34;, localaddr.String()) ip := addr.IP fmt.</description></item><item><title>Golangå®ç°ä¼˜å…ˆé˜Ÿåˆ—</title><link>https://hindung.cn/posts/go-priority-queue/</link><pubDate>Wed, 23 Sep 2020 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/go-priority-queue/</guid><description>å‰è¨€ ç”±äºåˆ·é¢˜æ—¶å¶å°”ä¼šç”¨åˆ°é˜Ÿåˆ—ä»¥åŠä¼˜å…ˆé˜Ÿåˆ—ç­‰æ•°æ®ç»“æ„ï¼Œå…¶ä»–è¯­è¨€éƒ½æœ‰ç°æˆçš„å®ç°ï¼Œå¦‚C++çš„priority_queueç­‰ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ç”±äºä¸ªäººæ¯”è¾ƒå–œæ¬¢ä½¿ç”¨golangè¯­è¨€è¿›è¡Œç­”é¢˜ï¼Œä½†æ˜¯goå¯¹é˜Ÿåˆ—ä»¥åŠä¼˜å…ˆé˜Ÿåˆ—çš„å®ç°åªæä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œå³container/heapåŒ…ä¸­çš„heapæ•°æ®ç»“æ„ï¼Œæ•…å®ç°è¿˜æ˜¯è¦è‡ªå·±å»ç ï¼Œè¿™é‡Œåšä¸€ä¸ªç¬”è®°ã€‚å®ç°äº†heapæ¥å£æ¥å®ç°priority_queueï¼Œå¹¶ä¸”æä¾›äº†å…¶ä»–æ–¹æ³•çš„å®ç°ã€‚
heapåŸç† goçš„container/heapåŒ…å®ç°çš„æ˜¯æ•°æ®ç»“æ„æ˜¯æ•°ç»„æ„æˆçš„äºŒå‰æ ‘ï¼ˆå®Œå…¨äºŒå‰æ ‘ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
// æ ‘ä¸­æŸä¸ªèŠ‚ç‚¹çš„å€¼æ€»æ˜¯ä¸å¤§äºæˆ–ä¸å°äºå…¶å­©å­èŠ‚ç‚¹çš„å€¼ï¼› // æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å­æ ‘éƒ½æ˜¯å †æ ‘ // index 0 1 2 3 4 5 6 7 8 9 // index 1 2 3 4 5 6 7 8 9 10 // a[] = {4, 1, 3, 2, 16, 9, 10, 14, 8, 7} // 4 // / \ // 1 3 // / \ / \ // 2 16 9 10 // /\ / // 14 8 7 // è‹¥å–a[1]ä¸ºå †é¡¶æœ€å¤§æˆ–æœ€å°ï¼Œa[i]çš„å·¦å­èŠ‚ç‚¹ä¸ºa[2i],å³å­èŠ‚ç‚¹ä¸ºa[2i+1],çˆ¶èŠ‚ç‚¹ä¸ºa[i/2]: // a[i] // / \ // a[2i] a[2i+1] // è‹¥å–a[0]ä¸ºå †é¡¶æœ€å¤§æˆ–æœ€å°ï¼Œa[i]çš„å·¦å­èŠ‚ç‚¹ä¸ºa[2i+1],å³å­èŠ‚ç‚¹ä¸ºa[2i+2],çˆ¶èŠ‚ç‚¹ä¸ºa[(i-1)/2] // a[i] // / \ // a[2i+1] a[2i+2] è€Œcontainer/heapåŒ…é‡‡ç”¨çš„æ˜¯a[0]ä½œä¸ºå¯¹é¡¶ï¼Œæ•…å·¦å­ã€å³å­èŠ‚ç‚¹ä»¥åŠçˆ¶èŠ‚ç‚¹è¡¨ç¤ºä¸ºa[2i+1]ã€a[2i+2]ã€a[(i-1)/2]ã€‚</description></item><item><title>é›ªèŠ±ç®—æ³•</title><link>https://hindung.cn/posts/snowflake/</link><pubDate>Thu, 27 Aug 2020 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/snowflake/</guid><description>å‰è¨€ å·¥ä½œé¡¹ç›®ä¸­æœ‰ä½¿ç”¨åˆ°é›ªèŠ±ç®—æ³•(snowflake)ï¼Œè§‰å¾—å¾ˆæœ‰æ„æ€ï¼Œæ‰€ä»¥æƒ³æ·±å…¥äº†è§£ä¸€ä¸‹å®ç°çš„åŸç†å¹¶åšè®°å½•ã€‚
ç®—æ³•ç®€ä»‹ ä»€ä¹ˆæ˜¯é›ªèŠ±ç®—æ³• snowflakeï¼Œé›ªèŠ±ã€‚æ‰€ä»¥snowflakeç®—æ³•å°±å«åšé›ªèŠ±ç®—æ³•ã€‚æœ€æ—©æ˜¯Twitterå†…éƒ¨ä½¿ç”¨çš„åˆ†å¸ƒå¼ç¯å¢ƒå”¯ä¸€IDç”Ÿæˆç®—æ³•ã€‚
è§£å†³äº†ä»€ä¹ˆé—®é¢˜ é‚£ä¹ˆï¼Œè¯¥ç®—æ³•ä¸»è¦è§£å†³äº†ï¼š
é«˜å¹¶å‘åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹IDä¸é‡å¤ åŸºäºæ—¶é—´æˆ³ï¼Œå¯ä»¥ä¿è¯æœ‰åºé€’å¢ ä¸ä¾èµ–ç¬¬ä¸‰æ–¹åº“æˆ–ä¸­é—´ä»¶ ç”Ÿæˆæ•ˆç‡é«˜ ç®—æ³•åŸç† ä½¿ç”¨ç»Ÿä¸€ä¸é‡å¤ç³»ç»Ÿç¼–å·çš„æœåŠ¡å™¨+æ¯«ç§’çº§æ—¶é—´æˆ³+é€’å¢åºåˆ—åŒ–ç”Ÿæˆ64bité•¿æ•´å‹æ•°å­—ï¼š
+-&amp;gt;1bit not use + 000000000000000000000000000000000000000000000000000000000000000 = 64 bit &amp;lt;--------------------------------------&amp;gt;&amp;lt;---+----&amp;gt;&amp;lt;----------&amp;gt; 41bit millisecond timestamp = 69 years | 12bit Inc num = 4096 v 10bit machine ID= 1024 64bitæ•´æ•°ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š
ç¬¬ä¸€ä½ç½®é›¶ï¼Œ1ä¸ºè´Ÿæ•°ï¼Œæ•…ä¸ç”¨ï¼› 41ä½è¡¨ç¤ºæ¯«ç§’çº§æ—¶é—´æˆ³ï¼› 10ä½è¡¨ç¤ºæœºå™¨IDï¼Œæœ€å¤šå¯ä»¥éƒ¨ç½²åœ¨1024å°æœåŠ¡å™¨ä¸Šï¼› 12ä½è¡¨ç¤º1æ¯«ç§’çš„å†…é€’å¢åºåˆ—ï¼Œä»0å¼€å§‹ï¼Œåˆ°4095ï¼› ä¹Ÿå°±æ˜¯è¯´åŒä¸€æ¯«ç§’å†…æœ€å¤šèƒ½ç”Ÿæˆ4096ä¸ªidï¼Œè¶…å‡ºçš„è¯éœ€è¦ç­‰å¾…ä¸‹ä¸€æ¯«ç§’ï¼Œé›ªèŠ±ç®—æ³•æœ€å¤šå†²çªç­‰å¾…1msã€‚
æœºå™¨IDä¿è¯äº†ç³»ç»Ÿå†…çš„æœºå™¨å”¯ä¸€æ€§ï¼Œæ—¶é—´æˆ³å’Œé€’å¢åºåˆ—å·ä¿è¯äº†æ—¶åºé€’å¢ã€‚
å®ç°æ€è·¯ äº†è§£äº†å”¯ä¸€IDçš„ç»“æ„ä¹‹åå°±å¯ä»¥ç®€å•å®ç°é›ªèŠ±ç®—æ³•ï¼ˆä¼ªä»£ç ï¼‰ï¼š
machineID # æœºå™¨ID n # é€’å¢åºåˆ— now := time().now().Unix() if now == last { # å¦‚æœæ˜¯åŒ1æ¯«ç§’å†… n++ # è‡ªå¢1 if n &amp;gt; 4095 { # è¶…è¿‡4095ï¼Œåˆ™ç­‰å¾…ä¸‹ä¸€æ¯«ç§’ now = nexttime() n = 0 } } else { n = 0 last = now } ID = now &amp;lt;&amp;lt; 22 | mashineID &amp;lt;&amp;lt; 12 | n # å°†ç»“æœæ‹¼æ¥ä¸º64bitä¹‹åè½¬æ¢æˆåè¿›åˆ¶ æ·±å…¥æºä»£ç  é›ªèŠ±ç”Ÿæˆç®—æ³•è§ï¼šsnowflake</description></item><item><title>Golang-channel</title><link>https://hindung.cn/posts/golang-channel/</link><pubDate>Sat, 01 Aug 2020 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/golang-channel/</guid><description>å‰è¨€ æœ¬æ–‡ä¸»è¦è®°å½•å¹³æ—¶ä½¿ç”¨Golangçš„channelå¯¹è±¡æ˜¯å¦‚ä½•åœ¨å†…å­˜ä¸­å­˜å‚¨å’Œå®ç°çš„ï¼ŒåŒ…æ‹¬channelçš„åˆ›å»ºã€å‘é€ã€æ¥æ”¶ã€å®ç°å’Œå…³é—­ï¼Œæœ€ä½³å®è·µç­‰ï¼Œæœ‰æ—¶è¿˜åº”è¯¥æ›´åŠ å…³æ³¨channelçš„é˜»å¡é—®é¢˜ï¼Œä»¥åŠselectåº•å±‚å®ç°ä¸channelçš„é€‰æ‹©æ‰§è¡Œã€‚
channelä¸goroutine goroutine, to execute tasks independently, potentially in parallel. channels, for communication, synchronization between goroutine.
æ­£å¦‚ä¸Šé¢è¯´çš„ï¼Œgoroutineæ˜¯ç‹¬ç«‹åœ°ï¼Œå¯èƒ½å¹¶è¡Œåœ°æ‰§è¡Œä»»åŠ¡ã€‚channelæ˜¯æœåŠ¡ä¸goroutineä¹‹é—´çš„é€šè®¯ï¼ŒåŒæ­¥ç­‰ã€‚
Goè¯­è¨€çš„å¹¶å‘æ¨¡å‹æ˜¯åŸºäºCSPçš„ï¼Œ Golangä»CSPä¸­å¸æ”¶äº†Process/Channelã€‚
channelæ˜¯ä¸€ç§ï¼š
åç¨‹å®‰å…¨ å¯ä»¥åœ¨åç¨‹ä¹‹é—´å­˜å‚¨å’Œä¼ è¾“å€¼ å…ˆè¿›å…ˆå‡º èƒ½å¤Ÿå¯¼è‡´åç¨‹é˜»å¡æˆ–ä¸é˜»å¡ï¼ˆblock or unblockï¼‰ å…³äºgoroutineçš„å†…å®¹ä»¥ååœ¨æ·±å…¥ï¼Œæœ¬æ–‡å°±é‡ç‚¹äº†è§£ä¸€ä¸‹channelã€‚
Do not communicate by sharing memory; instead, share memory by communicating.
è¿™æ˜¯Goè¯­è¨€çš„å¹¶å‘å“²å­¦ã€‚
ä¸‹é¢å°±æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹golangæ˜¯å¦‚ä½•å®ç°channelè¿™ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”å¦‚ä½•å®ç°goroutineä¹‹é—´çš„æ•°æ®é€šä¿¡çš„ã€‚
channelçš„åŸºæœ¬ä½¿ç”¨ var ch chan int //å£°æ˜ä¸€ä¸ªintç±»å‹çš„channelï¼Œæ³¨æ„ï¼Œè¯¥è¯­å¥ä»…å£°æ˜ï¼Œä¸åˆå§‹åŒ–channel ch := make(chan int) //åˆ›å»ºä¸€ä¸ªæ— ç¼“å†²çš„intå‹çš„channelï¼Œæ— ç¼“å†²çš„channelå½“æ”¾å…¥1ä¸ªå…ƒç´ åï¼Œåç»­çš„è¾“å…¥ä¾¿ä¼šé˜»å¡ ch := make(chan int, 10) //åˆ›å»ºä¸€ä¸ªç¼“å†²åŒºå¤§å°ä¸º10çš„intå‹çš„channel ch &amp;lt;- x //å°†xå‘é€åˆ°channelä¸­ï¼Œå¦‚æœchannelç¼“å†²åŒºæ»¡ï¼Œåˆ™é˜»å¡å½“å‰goroutine &amp;lt;- ch //ä»channelä¸­æ¥æ”¶ä¸€ä¸ªå€¼ï¼Œå¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œåˆ™é˜»å¡ x = &amp;lt;- ch //ä»channelä¸­æ¥æ”¶ä¸€ä¸ªå€¼å¹¶å­˜åˆ°xä¸­ï¼Œå¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œåˆ™é˜»å¡ x, ok = &amp;lt;- ch //ä»channelä¸­æ¥æ”¶ä¸€ä¸ªå€¼ï¼Œå¦‚æœchannelå…³é—­äº†ï¼Œé‚£ä¹ˆokä¸ºfalseï¼ˆåœ¨æ²¡æœ‰defaultselectè¯­å¥çš„å‰æä¸‹ï¼‰ï¼Œåœ¨channelæœªå…³é—­ä¸”ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œä¼šé˜»å¡ close(ch) //å…³é—­channel for item := range ch {} //ç­‰å¾…å¹¶å–å‡ºchannelä¸­çš„å€¼ï¼Œç›´åˆ°channelå…³é—­ï¼Œä¼šé˜»å¡ æ— ç¼“å†²åŒºçš„channel ä»æ— ç¼“å­˜çš„channelä¸­è¯»å–æ¶ˆæ¯ä¼šé˜»å¡ï¼Œç›´åˆ°goroutineå‘channelä¸­å‘é€æ¶ˆæ¯ï¼›åŒç†ï¼Œå‘æ— ç¼“å­˜çš„channel ä¸­å‘é€æ¶ˆæ¯ä¹Ÿä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰goroutineä»channelä¸­è¯»å–æ¶ˆæ¯ã€‚</description></item><item><title>Golangè¯­è¨€æ¨¡å‹</title><link>https://hindung.cn/posts/go-lang/</link><pubDate>Sun, 26 Jul 2020 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/go-lang/</guid><description>å‰è¨€ è¿™ç¯‡ç¬”è®°ä¸»è¦è®°å½•ä¸€ä¸‹å­¦ä¹ Goè§åˆ°çš„å„ç§æ•°æ®ç±»å‹ï¼Œä»æ•°æ®ç±»å‹åœ¨å†…å­˜çš„åˆ†å¸ƒä¸Šçœ‹äº†è§£å…¶ä¸­çš„åŸç†ï¼Œä¸»è¦åŒ…æ‹¬ï¼š
åŸºæœ¬ç±»å‹ï¼ˆint, string, uint, int8, int16, byte, rune, unitptr, float32, float64, complex64, complex128, boolç­‰ï¼‰ æ•°ç»„å’Œsliceçš„å†…å­˜æ¨¡å‹ï¼ˆstringæ˜¯ç‰¹æ®Šçš„sliceï¼‰ æŒ‡é’ˆçš„å†…å­˜æ¨¡å‹åŠunitpträ¸unsafe.Pointerã€æ™®é€šæŒ‡é’ˆ *Tçš„åŒºåˆ« mapçš„å†…å­˜æ¨¡å‹ structçš„å†…å­˜æ¨¡å‹å’Œå­—èŠ‚å¯¹é½ channelã€goroutineçš„å†…å­˜æ¨¡å‹ä»¥åå•ç‹¬è®°å½• interfaceçš„å†…å­˜æ¨¡å‹å·²ç»åœ¨ç¬¬ä¸€ç¯‡ç¬”è®°é‡Œ Goçš„å†…å­˜æ¨¡å‹ä¸Cè¯­è¨€å¾ˆåƒï¼Œæ‰€ä»¥äº†è§£Cè¯­è¨€åº”è¯¥å¾ˆå®¹æ˜“ç†è§£Goçš„å†…å­˜æ¨¡å‹ã€‚
åŸºæœ¬ç±»å‹çš„å†…å­˜æ¨¡å‹ Goè¯­è¨€æœ‰18ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼š
bool string rune byte int uint int8 uint8 int16 uint16 int32 uint32 int64 uint64 float32 float64 complex64 complex128 å…¶ä¸­stringå’Œboolç±»å‹æ¯”è¾ƒç‰¹æ®Šï¼Œè¿™ä¸ªåé¢è®¨è®ºã€‚
ç„¶å byte ç±»å‹æ˜¯uint8çš„åˆ«åï¼Œruneæ˜¯int32çš„åˆ«åã€‚
å¹³å°ç›¸å…³çš„æ•°æ®ç±»å‹æœ‰ï¼š
uintï¼šint32 æˆ–è€…æ˜¯ int64ï¼Œçœ‹æœºå­ç±»å‹ uintptrï¼šè¶³å¤Ÿè¡¨ç¤ºæŒ‡é’ˆå¤§å°çš„æ— ç¬¦å·æ•´æ•°ç±»å‹ è¿™äº›åŸºæœ¬ç±»å‹åœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºå¦‚ï¼š
æ•°ç»„å’Œåˆ‡ç‰‡ æ•°ç»„ å¯¹äºæ•°ç»„æ¥è¯´ï¼Œå¦‚ï¼švar arr = [5]byte{1,2,3,4,5}
å¯¹äºarrè¿™ä¸ª[5]byteç±»å‹ï¼Œä»–çš„å†…å­˜å°±æ˜¯5ä¸ªè¿ç»­çš„å­—èŠ‚, ä¸€ä¸ªæ•°ç»„çš„å®šä¹‰åŒæ—¶åŒ…æ‹¬äº†é•¿åº¦å’Œç±»å‹ã€‚ æ¯”å¦‚ï¼švar a [4]intï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºå£°æ˜äº†ä¸€ä¸ªç±»å‹æ˜¯æ•°ç»„ï¼Œå…ƒç´ ç±»å‹æ˜¯intï¼Œé•¿åº¦æ˜¯4ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯Goè¯­è¨€çš„æ•°ç»„å’ŒCè¯­è¨€çš„ä¸ä¸€æ ·ï¼ŒCè¯­è¨€çš„æ•°ç»„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ã€‚ä½†æ˜¯åœ¨Goè¯­è¨€é‡Œé¢æ•°ç»„å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å€¼ç±»å‹ã€‚è€Œä¸æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„å†…å­˜èµ·å§‹ä½ç½®çš„æŒ‡é’ˆï¼Œä¹Ÿä¸èƒ½å’ŒåŒç±»å‹çš„æŒ‡é’ˆè¿›è¡Œè½¬åŒ–ã€‚
æ‰€ä»¥[4]intå’Œ[5]intè¡¨ç¤ºä¸¤ç§å®Œå…¨ä¸åŒçš„ç±»å‹ã€‚
åˆ‡ç‰‡ åœ¨ä¹‹å‰çš„ä¸€äº›golangåŸºç¡€é‡Œå·²ç»æœ‰ä¸€äº›åˆ‡ç‰‡ç±»å‹çš„ç®€å•ä½¿ç”¨æ–¹æ³•äº†ï¼Œè¿™é‡Œå°±æ¥æ¢ç©¶ä¸€ä¸‹åˆ‡ç‰‡çš„åº•å±‚æ•°æ®ç»“æ„å’Œå®ç°ã€‚</description></item><item><title>åˆæ¢Ginæ¡†æ¶</title><link>https://hindung.cn/posts/gin/</link><pubDate>Sat, 25 Jul 2020 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/gin/</guid><description>å…¥é—¨ç®€ä»‹ Ginæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTP webæ¡†æ¶ï¼Œç”¨Goç¼–å†™ï¼Œç›®å‰æ‰˜ç®¡åœ¨GitHubä¸Šï¼šGin å®˜æ–¹æ–‡æ¡£ï¼šGin-doc ä¸­æ–‡ç‰ˆï¼šGin-doc Ginæ¡†æ¶çš„å‡ ä¸ªç‰¹æ€§ï¼š
è·¯ç”±ï¼ˆRoutingï¼‰ï¼šå°†è¯·æ±‚æ˜ å°„åˆ°å‡½æ•°ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±ã€‚å¦‚/hello/:name é‰´æƒï¼šç»Ÿä¸€ã€åˆ†ç»„é‰´æƒèƒ½åŠ› æ¨¡æ¿ï¼šç»Ÿä¸€ç®€åŒ–çš„HTMLæœºåˆ¶ ä¸­é—´ä»¶ï¼šä¸€ä¸ªè¯·æ±‚ç»è¿‡å¤šä¸ªä¸­é—´ä»¶æ‹¦æˆªæœ€ååˆ°è¾¾DBï¼Œå¦‚logging .etc å…¶ä¸­æ¯”è¾ƒå…³é”®çš„ç»„ä»¶æ˜¯routerè·¯ç”±ç»„ä»¶ï¼Œginä½¿ç”¨çš„ç®—æ³•æ˜¯radix æ ‘ï¼Œæ˜¯trie æ ‘ï¼ˆå‰ç¼€æ ‘ï¼‰çš„ä¸€ç§å‹ç¼©ç‰ˆæœ¬ï¼Œä»–ä»¬çš„åŒºåˆ«æ˜¯ï¼šå‡å¦‚å­˜åœ¨ä¸‰ä¸ªå•è¯ï¼šhello, hat, haveï¼Œtrie æ ‘å¾—åˆ°çš„æ•°æ®ç»“æ„æ˜¯ï¼š
e - l - l - o / h - a - t \ v - e æ€»å…±9ä¸ªèŠ‚ç‚¹ã€‚è€Œradixæ ‘å¾—åˆ°çš„æ•°æ®ç»“æ„æ˜¯ï¼š
* / (ello) / * - h - * -(a) - * - (t) - * \ (ve) \ * åªéœ€è¦5ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥ï¼Œradixæ ‘ä½¿ç”¨æ›´å°çš„å†…å­˜ï¼Œä½†æ˜¯å¾ˆéš¾å®ç°ã€‚è¯¦æƒ…è¯·å‚è€ƒï¼šwhat-is-the-difference-between-trie-and-radix-trie-data-structures
Ginä½¿ç”¨çš„radixç®—æ³•å®ç°æ˜¯ï¼šhttprouter
åŸç†åŠç”¨æ³• è·¯ç”±Routing goè¯­è¨€æœ¬èº«å†…ç½®äº†net/httpåº“ï¼Œå°è£…äº†HTTPç½‘ç»œæ¥å£ï¼ŒGinå®ç°çš„webæ¡†æ¶ä¹Ÿæ˜¯åŸºäºnet/httpåº“ã€‚
è¿™ä¸ªåº“çš„ç®€å•ç”¨æ³•ï¼š
package main import ( &amp;#34;fmt&amp;#34; &amp;#34;log&amp;#34; &amp;#34;net/http&amp;#34; ) func main() { http.</description></item><item><title>Golang-interfaceçš„åº•å±‚åŸç†æµ…æ</title><link>https://hindung.cn/posts/golang-interface/</link><pubDate>Thu, 23 Jul 2020 00:00:00 +0000</pubDate><guid>https://hindung.cn/posts/golang-interface/</guid><description>å‰è¨€ Goè¯­è¨€åœ¨è¯­æ³•ä¸Šç›¸å¯¹C/C++æ¥è¯´ï¼Œæ˜¯æ¯”è¾ƒç®€å•çš„ï¼ŒåŸºæœ¬è¯­æ³•å¤šåˆ·åˆ·é¢˜ç›®ï¼Œç„¶åå·¥ç¨‹çš„æ¶æ„ã€ç›®å½•è§„åˆ™ç­‰å¤šçœ‹çœ‹å…¶ä»–å¼€æºé¡¹ç›®ï¼Œå°±åº”è¯¥èƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ã€‚Goè¯­è¨€æ¯”è¾ƒæ ¸å¿ƒçš„è®¾è®¡ åŒ…æ‹¬interfaceã€å†…å­˜æ¨¡å‹ã€deferæœºåˆ¶ã€goroutineå®ç°ä¸è°ƒåº¦ã€cgoã€æ•°ç»„ä¸åˆ‡ç‰‡ã€Goç¼–è¯‘å™¨å’Œè¿æ¥å™¨ã€GCå®ç°è¿™å‡ å¤§å—ã€‚
æ³¨ï¼šæ‰€æœ‰æºç åŸºäº go version go1.13.5 windows/amd64
æœ¬ç¯‡ç¬”è®°ç›®çš„æ˜¯äº†è§£interfaceçš„ç‰¹æ€§ï¼Œå¹¶çŸ¥é“å¦‚ä½•ç”¨å¥½å®ƒã€‚
Interfaceå®šä¹‰ æ˜¯ä¸€ç§ç±»å‹ å¯ä»¥å®šä¹‰0ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼ˆä¸€ç»„è¡Œä¸ºï¼‰ å¯ä»¥åµŒå…¥å…¶ä»–æ¥å£ï¼ˆç›®æ ‡ç±»å‹æ–¹æ³•é›†ä¸­å¿…é¡»æ‹¥æœ‰åŒ…å«åµŒå…¥æ¥å£æ–¹æ³•åœ¨å†…çš„å…¨éƒ¨æ–¹æ³•æ‰ç®—å®ç°äº†è¯¥æ¥å£ï¼‰ å¦‚ï¼š
type Notifier interface { notify() } è¿™å°±å®šä¹‰äº†ä¸€ä¸ªåä¸ºNotifierçš„interfaceï¼Œå®ç°è¿™ä¸ªinterfaceå¾ˆç®€å•ï¼Œå®ç°notifyæ–¹æ³•å³å¯ï¼š
type User struct { nameã€€string } func (u *User) notify() { fmt.Printf(&amp;#34;Notify user name %s\n&amp;#34;, u.name) } å…¶ä»–ç»“æ„ä½“ä¹Ÿå¯ä»¥å®ç°è¿™ä¸ªinterfaceï¼š
type Admin struct { nameã€€string } func (a *Admin) notify() { fmt.Printf(&amp;#34;Sending admin name %s\n&amp;#34;, a.name) } è¿™ç§å®ç°æ˜¯DuckTypeï¼šç±»å‹ä¸éœ€è¦æ˜¾å¼å£°æ˜å®ƒå®ç°äº†æŸä¸ªæ¥å£ï¼šæ¥å£è¢«éšå¼åœ°å®ç°ã€‚å¤šä¸ªç±»å‹å¯ä»¥å®ç°åŒä¸€ä¸ªæ¥ã€‚
åœ¨è°ƒç”¨notifyçš„åœ°æ–¹å®ç°å¦‚ä¸‹æ–¹æ³•ï¼Œå³å¯å®ç°å¤šæ€æ€§ï¼Œå³é¢å‘æ¥å£ç¼–ç¨‹ï¼š
func sendNotify(n Notifier) { n.notify() } å‡½æ•°sendNotifyæ¥å—ä¸€ä¸ªå®ç°äº†Notifieræ¥å£çš„å€¼ä½œä¸ºå‚æ•°ã€‚ æ—¢ç„¶ä»»æ„ä¸€ä¸ªå®ä½“ç±»å‹éƒ½èƒ½å®ç°è¯¥æ¥å£ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å¯ä»¥é’ˆå¯¹ä»»æ„å®ä½“ç±»å‹çš„å€¼æ¥æ‰§è¡Œnotifyæ–¹æ³•ï¼Œè°ƒç”¨notifyæ—¶ï¼Œ ä¼šæ ¹æ®å¯¹è±¡çš„å®é™…å®šä¹‰æ¥å®ç°ä¸åŒçš„è¡Œä¸ºï¼Œä»è€Œå®ç°å¤šæ€è¡Œä¸ºã€‚</description></item></channel></rss>